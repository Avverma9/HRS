export const amenitiesList = [
  { name: "Pool", id: "poolCheckbox" },
  { name: "Fitness Center", id: "fitnessCheckbox" },
  { name: "Spa", id: "spaCheckbox" },
  { name: "Restaurant", id: "restaurantCheckbox" },
  { name: "Conference Room", id: "conferenceRoomCheckbox" },
  { name: "Wi-Fi Paid", id: "wifiCheckbox" },
  { name: "Parking", id: "parkingCheckbox" },
  { name: "Pet Friendly", id: "petFriendlyCheckbox" },
  { name: "Laundry Service", id: "laundryCheckbox" },
  { name: "Business Center", id: "businessCenterCheckbox" },
  { name: "Shuttle Service", id: "shuttleCheckbox" },
  { name: "24-Hour Front Desk", id: "frontDeskCheckbox" },
  { name: "Gym", id: "gymCheckbox" },
  { name: "Lounge Area", id: "loungeCheckbox" },
  { name: "Free Wi-Fi", id: "freeWifiCheckbox" },
  { name: "TV", id: "tvCheckbox" },
  { name: "Air Conditioning", id: "airConditioningCheckbox" },
  { name: "Coffee Maker", id: "coffeeMakerCheckbox" },
  { name: "Balcony", id: "balconyCheckbox" },
  { name: "Jacuzzi", id: "jacuzziCheckbox" },
  { name: "Barbecue Area", id: "barbecueCheckbox" },
  { name: "Room Service", id: "roomServiceCheckbox" },
  { name: "Ensuite Bathroom", id: "ensuiteBathroomCheckbox" },
  { name: "Telephone", id: "telephoneCheckbox" },
  { name: "Daily Housekeeping", id: "dailyHousekeepingCheckbox" },
  { name: "Complimentary Toiletries", id: "toiletriesCheckbox" },
  { name: "Closet", id: "closetCheckbox" },
  { name: "Iron and Ironing Board", id: "ironCheckbox" },
  { name: "Hair Dryer", id: "hairDryerCheckbox" },
  { name: "Safe", id: "safeCheckbox" },
  { name: "Mini Fridge", id: "miniFridgeCheckbox" },
  { name: "Microwave", id: "microwaveCheckbox" },
  { name: "Desk", id: "deskCheckbox" },
  { name: "Wake-up Service", id: "wakeUpServiceCheckbox" },
  { name: "Heating", id: "heatingCheckbox" },
  { name: "Cable Channels", id: "cableChannelsCheckbox" },
  { name: "Non-Smoking Rooms", id: "nonSmokingCheckbox" },
  { name: "Soundproof Rooms", id: "soundproofCheckbox" },
  { name: "Family Rooms", id: "familyRoomsCheckbox" },
  { name: "Elevator", id: "elevatorCheckbox" },
  { name: "Wheelchair Accessible", id: "wheelchairAccessibleCheckbox" },
  { name: "Airport Shuttle", id: "airportShuttleCheckbox" },
  { name: "Concierge Service", id: "conciergeCheckbox" },
  { name: "Valet Parking", id: "valetParkingCheckbox" },
  { name: "Currency Exchange", id: "currencyExchangeCheckbox" },
  { name: "ATM on Site", id: "atmCheckbox" },
  { name: "Gift Shop", id: "giftShopCheckbox" },
  { name: "Express Check-in Check-out", id: "expressCheckInCheckbox" },
  { name: "Tour Desk", id: "tourDeskCheckbox" },
  { name: "Ticket Service", id: "ticketServiceCheckbox" },
  { name: "Luggage Storage", id: "luggageStorageCheckbox" },
  { name: "Library", id: "libraryCheckbox" },
  { name: "Sun Terrace", id: "sunTerraceCheckbox" },
  { name: "Garden", id: "gardenCheckbox" },
  { name: "Picnic Area", id: "picnicAreaCheckbox" },
  { name: "Outdoor Furniture", id: "outdoorFurnitureCheckbox" },
  { name: "Terrace", id: "terraceCheckbox" },
  { name: "BBQ Facilities", id: "bbqFacilitiesCheckbox" },
  { name: "Vending Machine Drinks", id: "vendingMachineDrinksCheckbox" },
  { name: "Vending Machine Snacks", id: "vendingMachineSnacksCheckbox" },
  { name: "Special Diet Menus on request", id: "specialDietMenusCheckbox" },
  { name: "Packed Lunches", id: "packedLunchesCheckbox" },
  { name: "Bar", id: "barCheckbox" },
  { name: "Wine Champagne", id: "wineChampagneCheckbox" },
  { name: "Bottle of Water", id: "bottleOfWaterCheckbox" },
  { name: "Chocolate Cookies", id: "chocolateCookiesCheckbox" },
  { name: "Kid-Friendly Buffet", id: "kidFriendlyBuffetCheckbox" },
  { name: "Kid Meals", id: "kidMealsCheckbox" },
  { name: "Breakfast in the Room", id: "breakfastInRoomCheckbox" },
  { name: "Restaurant Buffet", id: "restaurantBuffetCheckbox" },
  { name: "Snack Bar", id: "snackBarCheckbox" },
  { name: "Fruit", id: "fruitCheckbox" },
  { name: "Buffet Breakfast", id: "buffetBreakfastCheckbox" },
  { name: "Continental Breakfast", id: "continentalBreakfastCheckbox" },
  { name: "Gluten-Free Options", id: "glutenFreeOptionsCheckbox" },
  { name: "Vegetarian Options", id: "vegetarianOptionsCheckbox" },
  { name: "Vegan Options", id: "veganOptionsCheckbox" },
  { name: "Halal Options", id: "halalOptionsCheckbox" },
  { name: "Kosher Options", id: "kosherOptionsCheckbox" },
  { name: "Allergy-Free Room", id: "allergyFreeRoomCheckbox" },
  { name: "Designated Smoking Area", id: "smokingAreaCheckbox" },
  { name: "Non-Smoking Throughout", id: "nonSmokingThroughoutCheckbox" },
  { name: "Kitchen", id: "kitchen" },
];

// Uses Ionicons names because HotelDetails is in React Native.
export const amenityIconById = {
  poolCheckbox: "water-outline",
  fitnessCheckbox: "barbell-outline",
  spaCheckbox: "sparkles-outline",
  restaurantCheckbox: "restaurant-outline",
  conferenceRoomCheckbox: "people-outline",
  wifiCheckbox: "wifi-outline",
  parkingCheckbox: "car-outline",
  petFriendlyCheckbox: "paw-outline",
  laundryCheckbox: "shirt-outline",
  businessCenterCheckbox: "briefcase-outline",
  shuttleCheckbox: "bus-outline",
  frontDeskCheckbox: "headset-outline",
  gymCheckbox: "barbell-outline",
  loungeCheckbox: "wine-outline",
  freeWifiCheckbox: "wifi-outline",
  tvCheckbox: "tv-outline",
  airConditioningCheckbox: "snow-outline",
  coffeeMakerCheckbox: "cafe-outline",
  balconyCheckbox: "home-outline",
  jacuzziCheckbox: "water-outline",
  barbecueCheckbox: "flame-outline",
  roomServiceCheckbox: "restaurant-outline",
  ensuiteBathroomCheckbox: "water-outline",
  telephoneCheckbox: "call-outline",
  dailyHousekeepingCheckbox: "sparkles-outline",
  toiletriesCheckbox: "water-outline",
  closetCheckbox: "file-tray-outline",
  ironCheckbox: "shirt-outline",
  hairDryerCheckbox: "leaf-outline",
  safeCheckbox: "lock-closed-outline",
  miniFridgeCheckbox: "cube-outline",
  microwaveCheckbox: "radio-outline",
  deskCheckbox: "desktop-outline",
  wakeUpServiceCheckbox: "alarm-outline",
  heatingCheckbox: "flame-outline",
  cableChannelsCheckbox: "tv-outline",
  nonSmokingCheckbox: "ban-outline",
  soundproofCheckbox: "volume-mute-outline",
  familyRoomsCheckbox: "people-outline",
  elevatorCheckbox: "swap-vertical-outline",
  wheelchairAccessibleCheckbox: "accessibility-outline",
  airportShuttleCheckbox: "airplane-outline",
  conciergeCheckbox: "people-circle-outline",
  valetParkingCheckbox: "car-sport-outline",
  currencyExchangeCheckbox: "cash-outline",
  atmCheckbox: "card-outline",
  giftShopCheckbox: "gift-outline",
  expressCheckInCheckbox: "clipboard-outline",
  tourDeskCheckbox: "map-outline",
  ticketServiceCheckbox: "ticket-outline",
  luggageStorageCheckbox: "briefcase-outline",
  libraryCheckbox: "book-outline",
  sunTerraceCheckbox: "sunny-outline",
  gardenCheckbox: "leaf-outline",
  picnicAreaCheckbox: "leaf-outline",
  outdoorFurnitureCheckbox: "bed-outline",
  terraceCheckbox: "business-outline",
  bbqFacilitiesCheckbox: "flame-outline",
  vendingMachineDrinksCheckbox: "wine-outline",
  vendingMachineSnacksCheckbox: "fast-food-outline",
  specialDietMenusCheckbox: "nutrition-outline",
  packedLunchesCheckbox: "fast-food-outline",
  barCheckbox: "wine-outline",
  wineChampagneCheckbox: "wine-outline",
  bottleOfWaterCheckbox: "water-outline",
  chocolateCookiesCheckbox: "nutrition-outline",
  kidFriendlyBuffetCheckbox: "happy-outline",
  kidMealsCheckbox: "happy-outline",
  breakfastInRoomCheckbox: "restaurant-outline",
  restaurantBuffetCheckbox: "restaurant-outline",
  snackBarCheckbox: "fast-food-outline",
  fruitCheckbox: "nutrition-outline",
  buffetBreakfastCheckbox: "restaurant-outline",
  continentalBreakfastCheckbox: "restaurant-outline",
  glutenFreeOptionsCheckbox: "leaf-outline",
  vegetarianOptionsCheckbox: "leaf-outline",
  veganOptionsCheckbox: "leaf-outline",
  halalOptionsCheckbox: "restaurant-outline",
  kosherOptionsCheckbox: "restaurant-outline",
  allergyFreeRoomCheckbox: "alert-circle-outline",
  smokingAreaCheckbox: "ban-outline",
  nonSmokingThroughoutCheckbox: "ban-outline",
  kitchen: "restaurant-outline",
};

const DEFAULT_AMENITY_ICON = "checkmark-circle-outline";

const normalizeAmenityName = (value) => {
  return String(value || "")
    .toLowerCase()
    .replace(/&/g, " and ")
    .replace(/[()/.,]/g, " ")
    .replace(/-/g, " ")
    .replace(/\s+/g, " ")
    .trim()
    .replace(/\bwi fi\b/g, "wifi");
};

const amenityByNormalizedName = amenitiesList.reduce((acc, item) => {
  acc[normalizeAmenityName(item.name)] = item;
  return acc;
}, {});

const tryKeywordIcon = (normalizedName) => {
  if (!normalizedName) return DEFAULT_AMENITY_ICON;

  if (normalizedName.includes("wifi")) return "wifi-outline";
  if (normalizedName.includes("parking") || normalizedName.includes("valet")) return "car-outline";
  if (normalizedName.includes("front desk")) return "headset-outline";
  if (normalizedName.includes("room service")) return "restaurant-outline";
  if (normalizedName.includes("housekeeping")) return "sparkles-outline";
  if (normalizedName.includes("coffee")) return "cafe-outline";
  if (normalizedName.includes("tv") || normalizedName.includes("cable")) return "tv-outline";
  if (normalizedName.includes("fridge")) return "cube-outline";
  if (normalizedName.includes("microwave")) return "radio-outline";
  if (normalizedName.includes("desk")) return "desktop-outline";
  if (normalizedName.includes("pet")) return "paw-outline";
  if (normalizedName.includes("gym") || normalizedName.includes("fitness")) return "barbell-outline";
  if (normalizedName.includes("pool") || normalizedName.includes("jacuzzi")) return "water-outline";
  if (normalizedName.includes("balcony") || normalizedName.includes("terrace")) return "home-outline";
  if (normalizedName.includes("kitchen") || normalizedName.includes("breakfast")) return "restaurant-outline";
  if (normalizedName.includes("smoking")) return "ban-outline";

  return DEFAULT_AMENITY_ICON;
};

export const findAmenityByName = (name) => {
  const normalized = normalizeAmenityName(name);
  if (!normalized) return null;

  const exact = amenityByNormalizedName[normalized];
  if (exact) return exact;

  const partial = amenitiesList.find((item) => {
    const itemName = normalizeAmenityName(item.name);
    return normalized.includes(itemName) || itemName.includes(normalized);
  });

  return partial || null;
};

export const getAmenityDisplayName = (name) => {
  const matched = findAmenityByName(name);
  return matched?.name || String(name || "");
};

export const getAmenityIconName = (name) => {
  const matched = findAmenityByName(name);
  if (matched?.id && amenityIconById[matched.id]) return amenityIconById[matched.id];
  return tryKeywordIcon(normalizeAmenityName(name));
};

export const defaultAmenityIconName = DEFAULT_AMENITY_ICON;

const splitAmenityText = (value) =>
  String(value || "")
    .split(/,|\||;/)
    .map((item) => item.trim())
    .filter(Boolean);

const extractAmenityTokens = (value) => {
  if (!value) return [];

  if (Array.isArray(value)) {
    return value.flatMap((item) => extractAmenityTokens(item));
  }

  if (typeof value === "string") {
    return splitAmenityText(value);
  }

  if (typeof value !== "object") return [];

  const tokens = [];

  const named = value?.name || value?.label || value?.title || value?.amenity;
  if (typeof named === "string") {
    tokens.push(...splitAmenityText(named));
  }

  const nestedArrays = [
    value?.amenities,
    value?.features,
    value?.facilities,
    value?.services,
    value?.items,
  ];
  nestedArrays.forEach((entry) => {
    tokens.push(...extractAmenityTokens(entry));
  });

  Object.entries(value).forEach(([key, flag]) => {
    const isEnabled = flag === true || flag === 1 || flag === "true";
    if (!isEnabled) return;
    if (!amenityIconById[key]) return;

    const byId = amenitiesList.find((item) => item.id === key);
    if (byId?.name) {
      tokens.push(byId.name);
      return;
    }
    tokens.push(key);
  });

  return tokens;
};

export const extractHotelAmenities = (hotel) => {
  const directSources = [
    hotel?.amenities,
    hotel?.basicInfo?.amenities,
    hotel?.features,
    hotel?.facilities,
    hotel?.services,
    hotel?.propertyAmenities,
  ];

  const roomLevelSources = Array.isArray(hotel?.rooms)
    ? hotel.rooms.flatMap((room) => [room?.amenities, room?.features, room?.facilities, room?.services])
    : [];

  const rawAmenityList = [...directSources, ...roomLevelSources].flatMap((entry) =>
    extractAmenityTokens(entry)
  );

  const normalizedSeen = new Set();
  const finalAmenityList = [];

  rawAmenityList.forEach((item) => {
    const display = getAmenityDisplayName(item);
    const normalized = normalizeAmenityName(display);
    if (!normalized || normalizedSeen.has(normalized)) return;
    normalizedSeen.add(normalized);
    finalAmenityList.push(display);
  });

  return finalAmenityList;
};

export const getTopHotelAmenities = (hotel, limit = 3) =>
  extractHotelAmenities(hotel).slice(0, Math.max(0, Number(limit) || 0));
